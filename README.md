# Building an API using a Node.js and Express Middleware

## Product includes following features:

1. implemented four custom `middleware` functions, detailed below.
1. Built an API to let clients perform CRUD operations on `users`.
1. Added endpoints to retrieve the list of `posts` for a `user` and to store a new `post` for a `user`.

#### Custom Middleware:

- `logger()`

  - `logger` logs to the console the following information about each request: request method, request url, and a timestamp
  - this middleware runs on every request made to the API

- `validateUserId()`

  - `validateUserId` validates the user id on every request that expects a user id parameter
  - if the `id` parameter is valid, store that user object as `req.user`
  - if the `id` parameter does not match any user id in the database, cancel the request and respond with status `400` and `{ message: "invalid user id" }`

- `validateUser()`

  - `validateUser` validates the `body` on a request to create a new user
  - if the request `body` is missing, cancel the request and respond with status `400` and `{ message: "missing user data" }`
  - if the request `body` is missing the required `name` field, cancel the request and respond with status `400` and `{ message: "missing required name field" }`

- `validatePost()`
  - `validatePost` validates the `body` on a request to create a new post
  - if the request `body` is missing, cancel the request and respond with status `400` and `{ message: "missing post data" }`
  - if the request `body` is missing the required `text` field, cancel the request and respond with status `400` and `{ message: "missing required text field" }`

### Database Persistence Helpers

There are two helper files that manages the persistence of _users_ and _posts_ data. These files are `users/userDb.js` and `posts/postDb.js`. Both files publish the following api:

- `get()`: calling find returns a promise that resolves to an array of all the `resources` contained in the database.
- `getById()`: takes an `id` as the argument and returns a promise that resolves to the `resource` with that id if found.
- `insert()`: calling insert passing it a `resource` object will add it to the database and return the new `resource`.
- `update()`: accepts two arguments, the first is the `id` of the `resource` to update and the second is an object with the `changes` to apply. It returns the count of updated records. If the count is 1 it means the record was updated correctly.
- `remove()`: the remove method accepts an `id` as it's first parameter and, upon successfully deleting the `resource` from the database, returns the number of records deleted.

The `userDb.js` helper includes an extra method called `getUserPosts()` that when passed a user's `id`, returns a list of all the `posts` for the `user`.


#### Database Schemas

The _Database Schemas_ for the `users` and `posts` resources are:

##### Users-Schema

| field | data type        | metadata                                            |
| ----- | ---------------- | --------------------------------------------------- |
| id    | unsigned integer | primary key, auto-increments, generated by database |
| name  | string           | required, unique                                    |

##### Posts-Schema

| field   | data type        | metadata                                            |
| ------- | ---------------- | --------------------------------------------------- |
| id      | unsigned integer | primary key, auto-increments, generated by database |
| text    | text             | required                                            |
| user_id | unsigned integer | required, must be the `id` of an existing `user`    |



# User Router endpoints:
### /api/

## Get All Users

#### _Method Url:_ `/api/users`

##### HTTP method: [GET]

#### Response
STATUS CODE: 200(OK)
EXAMPLE OUTPUT

```
[
    {
        "id": 4,
        "name": "Peregrin Cook"
    },
    {
        "id": 5,
        "name": "Mithrandir"
    },
    {
        "id": 6,
        "name": "Boromir"
    }
]  

```

STATUS CODE: 500(SERVER ERROR)

If there is a server or database error, the endpoint will return an HTTP response with a status code 500 and a body as below.

```
    {
        error: "users array not found!"
    }

```
-------------------------------

## Get User by Id

#### _Method Url:_ `/api/users/:id`

##### HTTP method: [GET]

#### Response
STATUS CODE: 200(OK)
EXAMPLE OUTPUT

```
{
    "id": 4,
    "name": "Peregrin Cook"
}  

```

STATUS CODE: 400(BAD REQUEST)

If there is a server or database error, the endpoint will return an HTTP response with a status code 500 and a body as below.

```
    {
        error: "user with specific id not found!"
    }

```
-------------------------------
## Get Posts of a Specfic User

#### _Method Url:_ `/api/users/:id/posts`

##### HTTP method: [GET]

#### Response
#### SUCCESSFUL
STATUS CODE: 200(OK)
EXAMPLE OUTPUT

```
[
    {
        "id": 10,
        "text": "We've had one yes. What about second lunch?",
        "postedBy": "Peregrin Cook"
    },
    {
        "id": 11,
        "text": "You need people of intelligence on this sort of mission...quest...thing.",
        "postedBy": "Peregrin Cook"
    }
]  

```
#### FAIL
STATUS CODE: 400(BAD REQUEST)

If there is a server or database error, the endpoint will return an HTTP response with a status code 500 and a body as below.

```
    {
        error: "post with specific id not found"
    }

```

-------------------------------


## Add a User to the Database

#### _Method Url:_ `/api/users`

##### HTTP method: [POST]

#### Request body

 {    
    "name": "Austin Miller"
 }


#### Response
#### SUCCESSFUL
STATUS CODE: 200(OK)
EXAMPLE OUTPUT

 {
    "id": 16,
    "name": "Austin Miller"
 }

#### FAIL 
STATUS CODE: 400(OK)
EXAMPLE OUTPUT(WRONG FIELD)

 {
    "error": "missing required name field"
 }

-------------------------------
## Add Post to a Specific User

#### _Method Url:_ `/api/users/:id/posts`

##### HTTP method: [POST]

#### Request body
EXAMPLE INPUT

{
  "text": "Programming is thinking, not typing"
}

#### Response
#### SUCCESSFUL
STATUS CODE: 200(OK)
EXAMPLE OUTPUT

{
    "id": 42,
    "text": "Programming is thinking, not typing",
    "user_id": 7
}

#### FAIL 
STATUS CODE: 400(OK)
EXAMPLE OUTPUT(WRONG FIELD)

 {
    "error": "missing required name field"
 }

-------------------------------
## Delete a User

#### _Method Url:_ `/api/users/:id`

##### HTTP method: [DELETE]

#### Response
#### SUCCESSFUL
204 (OK)

The endpoint will return a HTTP response with a status code 200 and the ID of The Deleted Rental

```
{
    message: "user is successfully deleted"
}
```
#### FAIL
500(SERVER ERROR)

If there is a server or database error, the endpoint will return an HTTP response with a status code 500 and a body as below.

```
    {
        error: "unsuccessful deletion"
    }

```

-------------------------------
## Update a User

#### _Method Url:_ `/api/users/:id`

##### HTTP method: [PUT]
#### Response
#### SUCCESSFUL
204 (OK)

{
    "id": 4,
    "name": "Larry King"
}

-------------------------------

# Post Router endpoints:
### /api/

## Get All Posts

#### _Method Url:_ `/api/posts`

##### HTTP method: [GET]

-------------------------------

## Get Post by Id

#### _Method Url:_ `/api/posts/:id`

##### HTTP method: [GET]

-------------------------------
## Delete the Post 

#### _Method Url:_ `/api/posts/:id`

##### HTTP method: [DELETE]

-------------------------------

## Upadate the Post

#### _Method Url:_ `/api/posts/:id`

##### HTTP method: [PUT]

-------------------------------




## Furture Goals

- Implementing registration and login endpoints `usersRouter.js`

 
